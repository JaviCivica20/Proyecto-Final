version: 2

sources:
  - name: dbt_proyecto_final # name of the source
    schema: dbt_proyecto_final # this is the schema our raw data lives in
    database: "{{ env_var('DBT_ENVIRONMENTS') }}_BRONZE_DB" # this is the name of our database

    quoting:
      database: false
      schema: false
      identifier: false

    freshness:
      warn_after: { count: 24, period: hour }
      error_after: { count: 48, period: hour }

    tables:
      - name: actor
        loaded_at_field: last_update
        columns:
          - name: actor_id
            tests: 
              - unique
              - not_null
          - name: first_name
          - name: last_name
          - name: last_update

      - name: address
        loaded_at_field: last_update
        columns:
          - name: address_id
            tests: 
              - unique
              - not_null
          - name: address
          - name: country
          - name: city
          - name: postal_code
          - name: last_update

      - name: category
        loaded_at_field: last_update
        columns:
          - name: category_id
            tests: 
              - unique
              - not_null
          - name: name
          - name: last_update
          
      - name: customer
        loaded_at_field: last_update
        columns:
          - name: customer_id
            tests: 
              - unique
              - not_null
          - name: store_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','store')
                field: store_id
          - name: first_name
          - name: last_name
          - name: email
          - name: address_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','address')
                field: address_id
          - name: active
          - name: create_date
          - name: last_update

      - name: film
        loaded_at_field: last_update
        columns:
          - name: film_id
            tests: 
              - unique
              - not_null
          - name: title
          - name: description
          - name: release_year
          - name: language_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','language')
                field: language_id
          - name: rental_duration
          - name: rental_rate
          - name: length
          - name: replacement_cost
          - name: rating
          - name: special_features
          - name: last_update

      - name: film_actor
        loaded_at_field: last_update
        columns:
          - name: actor_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','actor')
                field: actor_id
          - name: film_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','film')
                field: film_id
          - name: last_update

      - name: film_category
        loaded_at_field: last_update
        columns:
          - name: film_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','film')
                field: film_id
          - name: category_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','category')
                field: category_id
          - name: last_update
            
      - name: language
        loaded_at_field: last_update
        columns:
          - name: language_id
            tests: 
              - unique
              - not_null
          - name: name
          - name: last_update
      
      - name: payment
        loaded_at_field: last_update
        columns:
          - name: payment_id
            tests: 
              - unique
              - not_null
          - name: customer_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','customer')
                field: customer_id
          - name: staff_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','staff')
                field: staff_id
          - name: rental_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','rental')
                field: rental_id
          - name: amount
          - name: payment_date
          - name: last_update

      - name: rental
        loaded_at_field: last_update
        columns:
          - name: rental_id
            tests: 
              - unique
              - not_null
          - name: rental_date
          - name: customer_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','customer')
                field: customer_id
          - name: return_date
          - name: staff_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','staff')
                field: staff_id
          - name: last_update

      - name: staff
        loaded_at_field: last_update
        columns:
          - name: staff_id
            tests: 
              - unique
              - not_null
          - name: first_name
          - name: last_name
          - name: address_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','address')
                field: address_id
          - name: email
          - name: store_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','store')
                field: store_id
          - name: active
          - name: username
          - name: password
          - name: last_update
      
      - name: store
        loaded_at_field: last_update
        columns:
          - name: store_id
            tests: 
              - unique
              - not_null
          - name: manager_staff_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','staff')
                field: staff_id
          - name: address_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','address')
                field: address_id
          - name: last_update
        
      - name: purchases
        loaded_at_field: last_update
        columns:
          - name: purchase_id
            tests: 
              - unique
              - not_null
          - name: film_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','film')
                field: film_id
          - name: store_id
            tests:
            - relationships:
                to: source('dbt_proyecto_final','store')
                field: store_id
          - name: quantity
          - name: amount
          - name: purchase_date

   